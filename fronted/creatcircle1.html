<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>创建自己的兴趣圈</title>
    <link rel="stylesheet" href="src/createcircle.css">
</head>
<body>
    <div class="container">
        <h2>自己的兴趣圈</h2>
        <form action="#" method="post" onsubmit="return validateForm()" id="postForm">
            <div class="form-group">
                <label for="name">圈子名称：</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-groups">
                <label>圈子属性：</label>
                <input type="radio" id="open" name="property" value="open">
                <label for="open">公开</label>
                <input type="radio" id="close" name="property" value="close">
                <label for="close">不公开</label>
            </div>
            <br><br>
            <div class="form-group">
                <label for="category">圈子类别：</label>
                <textarea id="category" name="category" rows="4" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="description">圈子简介：</label>
                <textarea id="description" name="description" rows="4" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="rules">圈子规约：</label>
                <textarea id="rules" name="rules" rows="4" required></textarea>
            </div>
            <input type="submit" class="submit-button" value="提交">
        </form>
        <div>
            <img src="fronted/src/img1.png" alt="Image" class="bottom-left-image">
        </div>
        
        <div>
            <img src="https://upload-bbs.mihoyo.com/upload/2022/07/13/199553467/b0c4c20f2bd3858a3890addc9e37e653_3430826311242672280.gif?x-oss-process=image/auto-orient,0/interlace,1/format,gif" alt="Image" class="bottom-right-image">
        </div>
    </div>

    <script>
        function validateForm() {
            const name = document.getElementById('name').value;
            const open = document.getElementById('open').checked;
            const close = document.getElementById('close').checked;
            const category = document.getElementById('category').value;
            const description = document.getElementById('description').value;
            const rules = document.getElementById('rules').value;

            if (name === "" || (!open && !close) || category === "" || description === "" || rules === "") {
                alert("请完整填写所有必填项！");
                return false;
            }
            return true;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const postForm = document.getElementById('postForm');
            if (postForm) {
                postForm.addEventListener('submit', function(event) {
                    event.preventDefault(); // 阻止表单的默认提交行为

                    if (!validateForm()) {
                        return; // 如果表单验证不通过，阻止提交
                    }

                    const generateRandomId = () => {
                        return (Math.random() + 1).toString(36).substring(2, 12).toUpperCase();
                    };

                    const productionId = generateRandomId();

                    const data = {
                        name: document.getElementById('name').value,
                        property: document.querySelector('input[name="property"]:checked').value,
                        category: document.getElementById('category').value,
                        description: document.getElementById('description').value,
                        rules: document.getElementById('rules').value,
                        id: productionId
                    };

                    fetch('http://localhost:3000/circle', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => response.json())
                    .then(data => {
                        const url = 'mycircle?content=' + encodeURIComponent(JSON.stringify(data.content)) + '&id=' + encodeURIComponent(productionId);
                        window.open(url, '_blank');
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('发布失败');
                    });
                });
            }
        });
    </script>
</body>
</html>