<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美食</title>
    <link rel="stylesheet" href="src/book.css">
</head>

<body>
<div class="container">
    <div class="post">
        <div class="post-title">Chandler Bing</div>
        <div class="post-content">书籍是人类智慧的结晶，是知识的宝库和心灵的栖息地。每一本书都是一扇通向未知世界的窗户，打开它，仿佛能穿越时空，进入作者的思想和经历之中。书籍不仅记录了历史的变迁和文明的进步，还承载着无限的创造力和梦想。从古典文学到现代科技，从哲学思辨到奇幻冒险，每种类型的书籍都能引发不同的思考和感悟。阅读书籍，我们不仅能获得知识和信息，更能体验到不同的情感和人生。书籍是陪伴我们成长的良师益友，是激励我们前行的精神力量。在书页之间，我们发现了自我，也与世界进行了深刻的对话。书籍是我们灵魂的食粮，它们教会我们理解过去、把握现在、展望未来。</div>
        <img src="fronted/src/img12.png" alt="书籍图片" class="post-image">
        <img src="fronted/src/img13.png" alt="书籍图片" class="post-image">
        <img src="fronted/src/img14.png" alt="书籍图片" class="post-image">
        <div></div>
        <hr class="custom-hr">
        <div></div>
        <div class="comment-section">
            <div class="comment_title">评论:</div>
            <div class="comment">
                <span class="comment-author">小明:</span>
                <span class="comment-content">刚刚读完路遥的《平凡的世界》，这本书让我对人性和社会有了更深刻的理解。</span>
            </div>
            <div class="comment">
                <span class="comment-author">小王:</span>
                <span class="comment-content">作者对人物内心的刻画和社会背景的描绘都非常出色。</span>
            </div>
            <div id="comments"></div>
            <div class="comment-form">
                <textarea id="comment-input" rows="4" placeholder="添加评论..."></textarea>
                <br><br>
                <button onclick="addComment()">评论</button>
                <button onclick="others()">查看他的活动情况</button>
            </div>
        </div>
    </div>
    <div id="existing-content"></div>
    <div id="content-container">
        <div id="content"></div>
        <div id="images"></div>
    </div>
    <div class="comment-form">
        <button onclick="addPost(1)">发帖</button>   
        <button onclick="interest(1)">成员活动情况</button>
    </div>
       
</div>

<script>
    
    async function loadComments() {
        try {
            const response = await fetch('http://localhost:3000/testbook');
            if (!response.ok) throw new Error('网络响应不正常');
            const data = await response.json();
            const commentsDiv = document.getElementById('comments');
            commentsDiv.innerHTML = '';
            data.forEach(comment => {
                const commentDiv = document.createElement('div');
                commentDiv.classList.add('comment');
                commentDiv.innerHTML = `<span class="comment-author">${comment.author}:</span><span class="comment-content">${comment.content}</span>`;
                commentsDiv.appendChild(commentDiv);
            });
        } catch (error) {
            console.error('加载评论失败:', error);
        }
    }

    async function addComment() {
        const commentText = document.getElementById('comment-input').value;
        if (commentText.trim()) {
            try {
                const response = await fetch('http://localhost:3000/testbook', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ author: '新用户', content: commentText.trim() })
                });
                if (!response.ok) throw new Error('评论提交失败');
                document.getElementById('comment-input').value = '';
                loadComments();
            } catch (error) {
                console.error('添加评论失败:', error);
            }
        }
    }

    async function addComment1() {
        const commentText = document.getElementById('comment1').value;
        if (commentText.trim()) {
            try {
                const response = await fetch('http://localhost:3000/testall', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ author: '新用户', content: commentText.trim() })
                });
                if (!response.ok) throw new Error('评论提交失败');
                document.getElementById('comment1').value = '';
            } catch (error) {
                console.error('添加评论失败:', error);
            }
        }
    }
    
    document.addEventListener('DOMContentLoaded', loadComments);

    function addPost(id) {
        const url = "post.html";
        window.location.href = url;
    }
    
    function getcomment(id) {
        const url = "getmessage.html";
        window.location.href = url;
    }

    function others(id) {
        const url = "otherpage.html";
        window.location.href = url;
    }
    

    function interest(id) {
        const url = "showinterest.html";
        window.location.href = url;
    }

    function getQueryParams() {
        const params = {};
        const queryString = window.location.search.substring(1);
        const queryParts = queryString.split('&');
        queryParts.forEach(part => {
            const [key, value] = part.split('=');
            params[decodeURIComponent(key)] = decodeURIComponent(value);
        });
        return params;
    }

    async function displayContent() {
        try {
            // 发起网络请求以获取数据
            const response = await fetch(`http://localhost:3000/post`);

            // 解析 JSON 数据
            const data1 = await response.json();
            const data = data1[0];
            console.log('Data fetched:', data); // 调试信息：输出获取的数据

            // 将数据存入 LocalStorage
            localStorage.setItem('postData', JSON.stringify(data));

            // 创建新的 post 元素
            const newPost = document.createElement('div');
            newPost.classList.add('post');

            // 创建新的标题
            const newPostTitle = document.createElement('div');
            newPostTitle.classList.add('post-title');
            newPostTitle.textContent = data.title || '新用户'; // 使用从数据中获取的标题

            // 创建新的内容
            const newPostContent = document.createElement('div');
            newPostContent.classList.add('post-content');
            newPostContent.textContent = data.content || '内容缺失'; // 使用从数据中获取的内容

            // 将标题和内容添加到新的 post 中
            newPost.appendChild(newPostTitle);
            newPost.appendChild(newPostContent);

            // 添加图片
            

            const img = document.createElement('img');
            img.src = `http://localhost:3000/${data.imagePaths}`;
            img.alt =  data.imagePaths;
            img.classList.add('post-image');
            newPost.appendChild(img);


            // 创建评论区域
            const commentsSection = document.createElement('div');
            commentsSection.classList.add('comment-section');

            const commentsTitle = document.createElement('div');
            commentsTitle.classList.add('comment_title');
            commentsTitle.textContent = '评论:';
            commentsSection.appendChild(commentsTitle);

            // 创建评论表单
            const commentForm = document.createElement('div');
            commentForm.classList.add('comment-form');

            const commentTextarea = document.createElement('textarea');
            commentTextarea.id = 'comment1';
            commentTextarea.rows = 4;
            commentTextarea.placeholder = '添加评论...';
            commentForm.appendChild(commentTextarea);

            const commentButton = document.createElement('button');
            commentButton.textContent = '评论';
            commentButton.setAttribute('onclick', 'addComment1()'); // 去掉参数以简化
            commentForm.appendChild(commentButton);

            const commentButton1 = document.createElement('button');
            commentButton1.textContent = '查看评论情况';
            commentButton1.setAttribute('onclick', 'getcomment()'); // 去掉参数以简化
            commentForm.appendChild(commentButton1);

            commentsSection.appendChild(commentForm);

            // 将评论区域添加到新的 post 中
            newPost.appendChild(commentsSection);

            // 将新的 post 添加到页面的内容容器中
            const contentContainer = document.getElementById('content-container');
            if (contentContainer) {
                contentContainer.appendChild(newPost);
            } else {
                console.error('内容容器元素未找到。');
            }
        } catch (error) {
            console.error('Error:', error); // 捕获并输出错误信息
        }
    } 

    window.onload = displayContent();
</script>
</body>
</html>

